---
const pathname = Astro.url.pathname;

const links = [
  { href: '/', label: 'Home' },
  { href: '/mission', label: 'Mission' },
  { href: '/plugins', label: 'Plugins' },
  { href: '/apps', label: 'Apps' },
];
---

<nav class="bg-white shadow-sm fixed w-full top-0 z-50">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <div class="flex justify-between items-center h-16">
      <a href="/" class="flex items-center">
        <div class="flex-shrink-0">
          <svg class="size-8 text-blue-600" viewBox="0 0 32 32" fill="currentColor" aria-hidden="true">
            <rect x="6" y="6" width="20" height="20" rx="2" stroke="currentColor" stroke-width="2" fill="none" />
            <path d="M12 12h8v8h-8z" fill="currentColor" />
            <circle cx="16" cy="16" r="2" fill="white" />
          </svg>
        </div>
        <span class="ml-3 text-xl font-bold text-gray-900">Open WP Club</span>
      </a>
      <div class="hidden md:block">
        <div class="ml-10 flex items-baseline space-x-4">
          {links.map((link) => (
            <a
              href={link.href}
              class:list={[
                'px-3 py-2 rounded-md text-sm font-medium transition-colors duration-200',
                pathname === link.href || (link.href !== '/' && pathname.startsWith(link.href))
                  ? 'text-blue-600 bg-blue-50'
                  : 'text-gray-700 hover:text-blue-600',
              ]}
            >
              {link.label}
            </a>
          ))}
        </div>
      </div>
      <!-- Mobile menu button -->
      <button
        id="mobile-menu-btn"
        class="md:hidden inline-flex items-center justify-center p-2 rounded-md text-gray-700 hover:text-blue-600 hover:bg-gray-100 transition-colors duration-200"
        aria-label="Toggle navigation menu"
        aria-expanded="false"
        aria-controls="mobile-menu"
      >
        <svg id="menu-icon-open" class="size-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="1.5" aria-hidden="true">
          <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5" />
        </svg>
        <svg id="menu-icon-close" class="size-6 hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="1.5" aria-hidden="true">
          <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
        </svg>
      </button>
    </div>
    <!-- Mobile menu -->
    <div id="mobile-menu" class="hidden md:hidden pb-4" role="navigation" aria-label="Mobile navigation">
      {links.map((link) => (
        <a
          href={link.href}
          class:list={[
            'block px-3 py-2 rounded-md text-base font-medium',
            pathname === link.href || (link.href !== '/' && pathname.startsWith(link.href))
              ? 'text-blue-600 bg-blue-50'
              : 'text-gray-700 hover:text-blue-600',
          ]}
        >
          {link.label}
        </a>
      ))}
    </div>
  </div>
</nav>

<script>
  document.addEventListener('astro:page-load', () => {
    const btn = document.getElementById('mobile-menu-btn');
    const menu = document.getElementById('mobile-menu');
    const iconOpen = document.getElementById('menu-icon-open');
    const iconClose = document.getElementById('menu-icon-close');
    if (!btn || !menu || !iconOpen || !iconClose) return;

    function toggleMenu() {
      const isOpen = !menu!.classList.contains('hidden');
      menu!.classList.toggle('hidden');
      btn!.setAttribute('aria-expanded', String(!isOpen));
      iconOpen!.classList.toggle('hidden');
      iconClose!.classList.toggle('hidden');

      if (!isOpen) {
        const firstLink = menu!.querySelector('a');
        firstLink?.focus();
      }
    }

    btn.addEventListener('click', toggleMenu);

    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape' && !menu.classList.contains('hidden')) {
        toggleMenu();
        btn.focus();
      }
    });
  });
</script>
